{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { createContext, useReducer, useMemo, useContext, useEffect } from \"react\";\nimport * as axios from 'axios';\nimport { getItemAsync } from \"expo-secure-store\";\nimport AuthReducer, { initialState, RESTORE_TOKEN, SIGNIN, SIGNOUT } from \"../reducers/AuthReducer\";\nimport AppNavigation from \"../navigation/AppNavigation\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport var USER_TOKEN_KEY = 'userToken';\nexport var USER_KEY = 'user';\nexport var AuthContext = createContext();\nvar AuthProvider = function AuthProvider() {\n  var _useReducer = useReducer(AuthReducer, initialState),\n    _useReducer2 = _slicedToArray(_useReducer, 2),\n    state = _useReducer2[0],\n    dispatch = _useReducer2[1];\n  useEffect(function () {\n    var bootstrapAsync = function () {\n      var _ref = _asyncToGenerator(function* () {\n        var userToken;\n        try {\n          userToken = yield getItemAsync(USER_TOKEN_KEY);\n        } catch (e) {\n          alert('Token invalid ' + e.message);\n        }\n        dispatch({\n          type: RESTORE_TOKEN,\n          token: userToken\n        });\n      });\n      return function bootstrapAsync() {\n        return _ref.apply(this, arguments);\n      };\n    }();\n    bootstrapAsync().then(function () {});\n  });\n  var handleLogin = function () {\n    var _ref3 = _asyncToGenerator(function* (_ref2) {\n      var token = _ref2.token,\n        user = _ref2.user;\n      try {\n        dispatch({\n          type: SIGNIN,\n          token: token,\n          user: user\n        });\n      } catch (error) {\n        throw new Error(error);\n      }\n    });\n    return function handleLogin(_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var handleLogout = function () {\n    var _ref4 = _asyncToGenerator(function* (data) {\n      try {\n        delete axios.defaults.header.common['Authorization'];\n      } catch (error) {\n        throw new Error(error);\n      } finally {\n        dispatch({\n          type: SIGNOUT\n        });\n      }\n    });\n    return function handleLogout(_x2) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  var authContext = useMemo(function () {\n    return {\n      state: state,\n      handleLogin: handleLogin,\n      handleLogout: handleLogout\n    };\n  }, [state]);\n  return _jsx(AuthContext.Provider, {\n    value: authContext,\n    children: _jsx(AppNavigation, {\n      userToken: state.userToken\n    })\n  });\n};\nvar useAuth = function useAuth() {\n  return useContext(AuthContext);\n};\nexport { useAuth, AuthProvider };","map":{"version":3,"names":["React","createContext","useReducer","useMemo","useContext","useEffect","axios","getItemAsync","AuthReducer","initialState","RESTORE_TOKEN","SIGNIN","SIGNOUT","AppNavigation","jsx","_jsx","USER_TOKEN_KEY","USER_KEY","AuthContext","AuthProvider","_useReducer","_useReducer2","_slicedToArray","state","dispatch","bootstrapAsync","_ref","_asyncToGenerator","userToken","e","alert","message","type","token","apply","arguments","then","handleLogin","_ref3","_ref2","user","error","Error","_x","handleLogout","_ref4","data","defaults","header","common","_x2","authContext","Provider","value","children","useAuth"],"sources":["/Users/landroide/Desktop/ReactNative/Pros/WithExpo/Demo-project/src/providers/AuthProvider.js"],"sourcesContent":["import React, { createContext, useReducer, useMemo, useContext, useEffect } from \"react\";\nimport * as axios from 'axios'\nimport { getItemAsync } from \"expo-secure-store\";\nimport AuthReducer, { initialState, RESTORE_TOKEN, SIGNIN, SIGNOUT} from \"../reducers/AuthReducer\";\nimport AppNavigation from \"../navigation/AppNavigation\";\n\nexport const USER_TOKEN_KEY = 'userToken' \nexport const USER_KEY ='user'\n\nexport const AuthContext = createContext()\n\nconst AuthProvider = () => {\n\n    const [ state , dispatch ] = useReducer(AuthReducer, initialState)\n\n    useEffect(() => {\n        const bootstrapAsync = async() => {\n            let userToken;\n\n            try{\n                userToken = await getItemAsync(USER_TOKEN_KEY)\n            }catch(e){\n                alert('Token invalid ' + e.message )\n            }\n\n            dispatch({\n                type: RESTORE_TOKEN,\n                token: userToken\n            })\n        }\n        bootstrapAsync().then(() => {})\n    })\n\n    const handleLogin = async({ token, user }) => {\n        try {\n            dispatch({ type: SIGNIN, token, user })\n        } catch (error) {\n            throw new Error(error)\n        }\n    }\n\n    const handleLogout = async(data) => {\n        try {\n            delete axios.defaults.header.common['Authorization']\n        } catch (error) {\n            throw new Error(error)\n        }finally{\n            dispatch({ type: SIGNOUT })\n        }\n    }\n\n    const authContext = useMemo(() => {\n        return {\n            state, handleLogin, handleLogout\n        }\n    }, [state])\n\n    return(\n        <AuthContext.Provider value={authContext}>\n            <AppNavigation userToken={state.userToken}/>\n        </AuthContext.Provider>\n    )\n}\n\nconst useAuth = () => useContext(AuthContext)\n\nexport { useAuth, AuthProvider }"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}